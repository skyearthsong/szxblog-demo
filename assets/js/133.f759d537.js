(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{366:function(s,e,n){"use strict";n.r(e);var t=n(42),a=Object(t.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"vite工程搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vite工程搭建"}},[s._v("#")]),s._v(" vite工程搭建")]),s._v(" "),n("h2",{attrs:{id:"vite介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vite介绍"}},[s._v("#")]),s._v(" vite介绍")]),s._v(" "),n("p",[s._v("vite 在开发的时候没有打包的过程，ES 模块源码直接传输给浏览器，浏览器使用自带的 <script module> 进行解析支持，通过 HTTP 请求进行每次 import，开发服务器拦截请求和对需要转换的代码进行转换。例如：*.vue 文件会在发回浏览器之前进行编译\n这个带来的一个限制就是vite必须在较新的浏览器中使用，对浏览器兼容性并未做特殊的处理，如果有浏览器版本要求，则需要自行研究polyfill及autoprefixer")]),s._v(" "),n("p",[s._v("这样操作有许多优势：")]),s._v(" "),n("p",[s._v("开发服务器启动后不需要进行打包操作，启动会变得非常迅速\n代码在需要的时候进行编译，所以只有代码真正在屏幕上展现的时候才进行编译。开始开发的时候再也不需要等待整个应用编译完成，这对大型应用是一个巨大的改变\n热模块替换的性能和模块的数量之间的关系解耦，热模块替换变得非常快\n导入本地 ES 模块可能会引发深层的导入链路，整个页面重新加载会比依赖打包的开发服务器略慢。然而这是一个本地开发服务器，这部分增加的时间和实际编译的时间相比应该非常小（编译的文件会被缓存在内存中）")]),s._v(" "),n("p",[s._v("vite 的编译本质上还是的 Node.js 中进行，从技术上讲它可以支持打包工具能支持的各种代码转换，没有什么可以阻止你将代码包用于生产，实际上，vite 提供了vite build的脚本用于这个操作，因此不会在生产环境中遭遇到网络流爆炸的问题")]),s._v(" "),n("h2",{attrs:{id:"初始化工程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#初始化工程"}},[s._v("#")]),s._v(" 初始化工程")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("npm init vite-app \nnpm run dev \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"问题记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题记录"}},[s._v("#")]),s._v(" 问题记录")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Failed at the esbuild@0.6.5 postinstall script.\n切换网络，postinstall会下载一个文件，reform下载失败。")])]),s._v(" "),n("li",[n("p",[s._v("vite: command not found\nnpm库下载失败，重新执行npm i")])]),s._v(" "),n("li",[n("p",[s._v("[vite] Dep optimization failed with error:Dependency esbuild is attempting to import Node built-in module tty.\n因为之前安装失败esbuild，所以手动执行过npm i esbuild，导致这个包被加入package.json的dependencies目录下，去除这个项后重新运行，项目成功打开。")])])]),s._v(" "),n("h2",{attrs:{id:"特点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),n("ul",[n("li",[s._v("Bare Module Resolving 空模块解析\n原生es的import语法不支持导入空模块，vite检测到空模块的引入时，回去查找所有的js结尾的文件，如果找到对应的路径自动去重定向到对应的地址。\n此外对vue做了额外处理，如果本地没有安装vue，vite会使用自身依赖的vue版本，这样就能快速使用vue相关内容")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import { createApp } from 'vue'\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("vite会根据路径进行搜索查找对应的模块")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("hot module reload模块热加载\n可以通过以下\nimport.meta.hot\nimport.meta.hot.accept\nimport.meta.hot.acceptDeps\nimport.meta.hot.dispose")])]),s._v(" "),n("li",[n("p",[s._v('支持Typescript\n支持直接引入 .ts文件和<script lang="ts"> 标签引用 （out of the box开箱即用）.\n但是vite只是进行语法解析，不会进行类型校验，默认这个在IDE或编译中完成。\n这就使得在使用esbuild的时候效率比tsc快20倍，HMR耗时在50ms以内\n注意使用中，有些特性不支持，需要在tsconfig.json中的compilerOptions中配置isolatedModules为true。')])]),s._v(" "),n("li",[n("p",[s._v("CSS / JSON Importing\n可以直接在js或vue中引用.css和.json文件，json文件会被当做导出的默认对象。css文件不会导出如何东西，除非是以.module.css结尾。这些引入都支持热加载")])]),s._v(" "),n("li",[n("p",[s._v("资源URL处理\n可以通过绝对路径或者相对路径的方式在vue或css中直接引用静态资源文件，所有被引用的资源都会被复制到dist文件夹下，生成环境文件名会添加hash值。未引用的资源不会被复制，图片小于64kb会进行base64处理")])])]),s._v(" "),n("p",[s._v("public目录用于存放一些不在源码中引用的静态资源，或者是名字必须固定不能以hash值结尾的文件。这些文件会直接复制到dist目录下。引用这个目录下的文件都需要以根路径开始，如public/a.png在代码中就是以/a.png方式引用。")]),s._v(" "),n("p",[s._v("如果工程部署是在一个嵌套的public path中，则需要指定--base=/your/public/path/，所有的资源文件路径都会被重写。")]),s._v(" "),n("p",[s._v("如果是需要动态引用，可以通过在js中以相对路径的引用import path from './foo.png'，或者引用全局变量import.meta.env.BASE_URL（注意不能写成import.meta.env['BASE_URL']）")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("PostCSS\n只需配置postcss.config.js，就可以把postCss应用到所有.vue文件中")])]),s._v(" "),n("li",[n("p",[s._v("CSS modules\n如果使用cssmodule就不需要使用postcss，在.vue文件中，通过<style module>调用，在.css文件中通过将文件命名为*.module.css")])]),s._v(" "),n("li",[n("p",[s._v("CSS Pre-Processors\n因为vite只用于高版本浏览器，所以建议使用实现了CSSWG方案的postCss插件（postcss-nesting），如果确实需要使用可以用以下方式")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("yarn add -D sass\n<style lang=\"scss\">\n/* use scss */\n</style>\nimport './style.scss'\n// vite.config.js\nmodule.exports = {\n  cssPreprocessOptions: {\n    less: {\n      modifyVars: {\n        'preprocess-custom-color': 'green'\n      }\n    }\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ul",[n("li",[n("p",[s._v("JSX\n.jsx和.tsx都支持，但是基于vue的jsx的暂不支持HMR\n如果想使用react或"),n("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/30796007",target:"_blank"}},[s._v("preact")]),s._v("的jsx，需要添加参数--jsx react or --jsx preact.")])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/bff8aa23fe4d",target:"_blank"}},[s._v("Web Assembly")]),n("a",{attrs:{href:"https://wasm.zcopy.site",target:"_blank"}},[s._v("中文网 ")]),s._v("\n可以直接引用web assembly类型文件.wasm")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import init from './example.wasm'\n\ninit().then(exports => {\n  exports.test()\n})\ninit({\n  imports: {\n    someFunc: () => { /* ... */ }\n  }\n}).then(() => { /* ... */ })\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("ul",[n("li",[s._v("内联Web Workers\n一个web worker脚本可以直接在import语句中增加?worker进行引用。在生产类型的编译中，worker会被转化为base64转码的String到bundle文件中。dev环境中需要依赖浏览器的支持，目前支持chrome。")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("import MyWorker from './worker?worker'\n\nconst worker = new MyWorker()\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("如果不希望内联worker，需要把worker脚本放入public目录，并且通过new Worker('/worker.js')引用")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("配置文件\n可以配置默认的vite.config.js 或 vite.config.ts，或者通过vite --config my-config.js指定特定的配置文件")])]),s._v(" "),n("li",[n("p",[s._v("自定义代码块\n支持在Vue SFCs（single file component）中使用自定义代码块，使用自定义代码块，需要在config配置文件中定义vueCustomBlockTransforms")])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// vite.config.js\nmodule.exports = {\n  vueCustomBlockTransforms: {\n    i18n: ({ code }) => {\n      // return transformed code\n    }\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("ul",[n("li",[s._v("HTTPS/2\n通过启动服务时增加 --https可以开启一个自认证证书的https服务，如需指定特定的证书可以通过httpsOptions设定，支持设定key, cert, ca 和 pfx 和在Node的https.ServerOptions.，并且开通http/2")]),s._v(" "),n("li",[s._v("dev server proxy\n可以在配置文件中设置proxy代理。vite使用的是koa-proxies")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("// vite.config.js\nmodule.exports = {\n  proxy: {\n    // string shorthand\n    '/foo': 'http://localhost:4567/foo',\n    // with options\n    '/api': {\n      target: 'http://jsonplaceholder.typicode.com',\n      changeOrigin: true,\n      rewrite: path => path.replace(/^\\/api/, '')\n    }\n  }\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("生产环境编译\nvite在进行生产打包时会把依赖都进行整合，因为原生es模块引用会引发大量的网络请求，是的页面加载时间过长，通过vite build命令进行打包。")]),s._v(" "),n("li",[s._v("运行模式和环境变量\nmode选项用来指定全局变量import.meta.env.MODE的值，默认有development（用于vite 和vite serve）和production(用于vite build)")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("vite build --mode development\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("环境变量可以从以下文件中获取")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(".env                # loaded in all cases\n.env.local          # loaded in all cases, ignored by git\n.env.[mode]         # only loaded in specified env mode\n.env.[mode].local   # only loaded in specified env mode, ignored by git\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("npm库下载失败，重新执行npm i")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("增加一个组件后，刷新页面报错__VUE_HMR_RUNTIME__ is not defined\n重启服务后解决")])]),s._v(" "),n("li",[n("p",[s._v("The requested module '/@modules/vue?import' does not provide an export named 'default'\n原因是vue3中不在使用@vue/composition-api，直接import { inject } from 'vue'就好了")])]),s._v(" "),n("li",[n("p",[s._v("vite中使用ant-design-vue组件（暂时不可行，因为ant-design-vue是基于vue2的）")])]),s._v(" "),n("li",[n("p",[n("a",{attrs:{href:"http://www.wazhi.com.cn/SchoolManage/NewsDispatcher?NewsId=440f7377-b293-4243-b629-bbf90bdf5231&SchoolId=1168&action=singlenews",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite启动路径分析"),n("OutboundLink")],1)])])]),s._v(" "),n("h2",{attrs:{id:"vite引入ant-design-vue组件库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vite引入ant-design-vue组件库"}},[s._v("#")]),s._v(" vite引入ant-design-vue组件库")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("export default {\n    optimizeDeps: {\n        include: [\n            'ant-design-vue/es/button/index'\n        ]\n    }\n}\nimport {Button} from 'ant-design-vue'\nimport 'ant-design-vue/dist/antd.css'; \n<a-icon type=\"step-forward\" />\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);